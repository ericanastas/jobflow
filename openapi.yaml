openapi: "3.0.3"
info:
  title: Job Flow API
  version: "0.1.0"
tags:
  - name: Connections
    description: Connections to job posting sites
  - name: Stages
    description: The stages of a job application
  - name: Jobs
    description: Jobs applications being tracked
  - name: Job Stages
    description: Stages of job applications
  - name: Posts
    description: Job posts
  - name: Queries
    description: Queries sent to a connections
paths:
  /api/connectors:
    get:
      tags: [Connections]
      summary: List installed connectors
      responses:
        200:
          $ref: "#/components/responses/ConnectorArrayRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/connections:
    get:
      tags: [Connections]
      summary: List connections
      responses:
        200:
          $ref: "#/components/responses/ConnectionArrayRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    post:
      tags: [Connections]
      summary: Create a connection
      requestBody:
        $ref: "#/components/requestBodies/PostConnectionReq"
      responses:
        201:
          $ref: "#/components/responses/ConnectionRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/connections/{connectionId}:
    parameters:
      - $ref: "#/components/parameters/connectionId"
    get:
      tags: [Connections]
      summary: Get a connection
      responses:
        200:
          $ref: "#/components/responses/ConnectionRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    put:
      tags: [Connections]
      summary: Update a connection
      requestBody:
        $ref: "#/components/requestBodies/PutConnectionReq"
      responses:
        200:
          $ref: "#/components/responses/ConnectionRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    delete:
      tags: [Connections]
      summary: Delete a connection
      responses:
        204:
          $ref: "#/components/responses/NoContentRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/stages:
    get:
      tags: [Stages]
      summary: List stages
      responses:
        200:
          $ref: "#/components/responses/StageArrayRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    post:
      tags: [Stages]
      summary: Create a stage
      requestBody:
        $ref: "#/components/requestBodies/PostStageReq"
      responses:
        201:
          $ref: "#/components/responses/StageRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/stages/{stageId}:
    parameters:
      - $ref: "#/components/parameters/stageId"
    get:
      tags: [Stages]
      summary: Get a stage
      responses:
        200:
          $ref: "#/components/responses/StageRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    put:
      tags: [Stages]
      summary: Update a stage
      requestBody:
        $ref: "#/components/requestBodies/PutStageReq"

      responses:
        200:
          $ref: "#/components/responses/StageRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    delete:
      tags: [Stages]
      summary: Delete a stage
      responses:
        204:
          $ref: "#/components/responses/NoContentRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/jobs:
    get:
      parameters:
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/page"
        - $ref: "#/components/parameters/searchFilter"
      tags: [Jobs]
      responses:
        200:
          $ref: "#/components/responses/JobCollectionRes"
    post:
      tags: [Jobs]
      requestBody:
        $ref: "#/components/requestBodies/PostJobReq"
      responses:
        201:
          $ref: "#/components/responses/JobRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/jobs/{jobId}:
    parameters:
      - $ref: "#/components/parameters/jobId"
    get:
      tags: [Jobs]
      responses:
        200:
          $ref: "#/components/responses/JobRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    put:
      tags: [Jobs]
      requestBody:
        $ref: "#/components/requestBodies/PutJobReq"
      responses:
        200:
          $ref: "#/components/responses/JobRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    delete:
      tags: [Jobs]
      responses:
        204:
          $ref: "#/components/responses/NoContentRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/jobs/{jobId}/stages:
    parameters:
      - $ref: "#/components/parameters/jobId"
    get:
      tags: [Job Stages]
      summary: List stages of a job
      responses:
        200:
          $ref: "#/components/responses/JobStageArrayRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    post:
      tags: [Job Stages]
      summary: Create a job stage
      requestBody:
        $ref: "#/components/requestBodies/PostJobStageReq"
      responses:
        201:
          $ref: "#/components/responses/JobStageRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        500:
          $ref: "#/components/responses/ErrorRes"
  /api/job-stages/{jobStageId}:
    parameters:
      - $ref: "#/components/parameters/jobStageId"
    get:
      tags: [Job Stages]
      responses:
        200:
          $ref: "#/components/responses/JobStageRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    put:
      tags: [Job Stages]
      summary: Update a job stage
      requestBody:
        $ref: "#/components/requestBodies/PutJobStageReq"
      responses:
        200:
          $ref: "#/components/responses/JobStageRes"
        400:
          $ref: "#/components/responses/BadRequestRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"
    delete:
      tags: [Job Stages]
      summary: Delete a job stage
      responses:
        204:
          $ref: "#/components/responses/NoContentRes"
        404:
          $ref: "#/components/responses/NotFoundRes"
        500:
          $ref: "#/components/responses/ErrorRes"

  /api/queries:
    get:
      tags: [Queries]
      responses:
        200:
          description: OK
  /api/connections/{connectionId}/queries:
    parameters:
      - $ref: "#/components/parameters/connectionId"
    get:
      tags: [Queries]
      responses:
        200:
          description: OK
  /api/posts:
    get:
      tags: [Posts]
      responses:
        200:
          description: OK
  /api/queries/{queryId}:
    parameters:
      - $ref: "#/components/parameters/queryId"
    get:
      tags: [Queries]
      responses:
        200:
          description: OK
  /api/queries/{queryId}/results:
    parameters:
      - $ref: "#/components/parameters/queryId"
    get:
      tags: [Queries]
      responses:
        200:
          description: OK
  /api/queries/{queryId}/logs:
    parameters:
      - $ref: "#/components/parameters/queryId"
    get:
      tags: [Queries]
      responses:
        200:
          description: OK

components:
  parameters:
    pageSize:
      in: query
      name: pageSize
      description: The maximum number of items per page
      required: false
      schema:
        type: integer
        minimum: 1
    page:
      in: query
      name: page
      description: The page of the collection
      required: false
      schema:
        type: integer
        minimum: 1
    searchFilter:
      in: query
      name: search
      description: Search query
      required: false
      schema:
        type: string
    stageId:
      in: path
      name: stageId
      description: The id of a stage
      required: true
      schema:
        type: integer
    connectionId:
      in: path
      name: connectionId
      description: The id of a connection
      required: true
      schema:
        type: integer
    queryId:
      in: path
      name: queryId
      description: The id of a query
      required: true
      schema:
        type: integer

    jobId:
      in: path
      name: jobId
      description: The id of a job
      required: true
      schema:
        type: integer
    jobStageId:
      in: path
      name: jobStageId
      description: The id of a stage of a specific job
      required: true
      schema:
        type: integer

  responses:
    ErrorRes:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 500
            name: "Error"
            message: "I'm sorry Dave. I'm afraid I can't do that."
    BadRequestRes:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 400
            name: "Bad Request"
            message: "request/params/contextId must be integer"
    NotFoundRes:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
          example:
            status: 404
            name: "Not Found"
            message: "Item not found"
    NoContentRes:
      description: No Content
    ConnectorArrayRes:
      description: Connector Array
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ConnectorArray"
    ConnectionArrayRes:
      description: Connection Array
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ConnectionArray"
    ConnectionRes:
      description: Connection
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Connection"
    StageRes:
      description: Stage
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Stage"

    StageArrayRes:
      description: Stage Array
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/StageArray"

    JobRes:
      description: Job
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Job"

    JobCollectionRes:
      description: Job Collection
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/JobCollection"

    JobStageRes:
      description: Job Stage
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/JobStage"

    JobStageArrayRes:
      description: Job Stage Array
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/JobStageArray"

  requestBodies:
    PostConnectionReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              connector:
                $ref: "#/components/schemas/Connection/properties/connector"
              name:
                $ref: "#/components/schemas/Connection/properties/name"
              config:
                $ref: "#/components/schemas/Connection/properties/config"
    PutConnectionReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              connector:
                $ref: "#/components/schemas/Connection/properties/connector"
              config:
                $ref: "#/components/schemas/Connection/properties/config"
    PostStageReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                $ref: "#/components/schemas/Stage/properties/name"
              color:
                $ref: "#/components/schemas/Stage/properties/color"
    PutStageReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                $ref: "#/components/schemas/Stage/properties/name"
              color:
                $ref: "#/components/schemas/Stage/properties/color"
    PostJobReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              primaryPostId:
                $ref: "#/components/schemas/Job/properties/primaryPostId"
              comments:
                $ref: "#/components/schemas/Job/properties/comments"
    PutJobReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              primaryPostId:
                $ref: "#/components/schemas/Job/properties/primaryPostId"
              comments:
                $ref: "#/components/schemas/Job/properties/comments"
    PostJobStageReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              stageId:
                $ref: "#/components/schemas/JobStage/properties/stageId"
              timestamp:
                $ref: "#/components/schemas/JobStage/properties/timestamp"
              comments:
                $ref: "#/components/schemas/JobStage/properties/comments"
              url:
                $ref: "#/components/schemas/JobStage/properties/url"
    PutJobStageReq:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              stageId:
                $ref: "#/components/schemas/JobStage/properties/stageId"
              timestamp:
                $ref: "#/components/schemas/JobStage/properties/timestamp"
              comments:
                $ref: "#/components/schemas/JobStage/properties/comments"
              url:
                $ref: "#/components/schemas/JobStage/properties/url"

  schemas:
    Stage:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: Interviewing
        color:
          type: string
          example: "#6200ff"
          description: Hex code of color used to identify stage
    StageArray:
      type: array
      items:
        $ref: "#/components/schemas/Stage"
    Connector:
      type: object
      properties:
        name:
          type: string
          example: linkedin
        version:
          type: string
          example: "0.1.0"
        description:
          type: string
          example: Queries linked.com for job postings
        configSchema:
          type: object
        querySchema:
          type: object
    ConnectorArray:
      type: array
      items:
        $ref: "#/components/schemas/Connector"
    Connection:
      type: object
      properties:
        id:
          type: integer
          description: Id of connection
        connector:
          type: string
          description: name of the connector
          example: ACME Jobs
        name:
          type: string
          example: Developer jobs on ACME Jobs
          description: Name of the connection

        config:
          nullable: true
          type: object
          description: Configuration of connection that matches `configSchema` of connector
    ConnectionArray:
      type: array
      items:
        $ref: "#/components/schemas/Connection"
    Job:
      type: object
      properties:
        id:
          type: string
        comments:
          type: string
          example: Custom notes about job
        primaryPostId:
          type: integer

        _embedded:
          type: object
          properties:
            currentStage:
              $ref: "#/components/schemas/Stage"
            primaryPost:
              $ref: "#/components/schemas/Post"
    JobCollection:
      type: object
      description: A collection of jobs
      allOf:
        - $ref: "#/components/schemas/Collection"
      properties:
        _embedded:
          type: object
          properties:
            jobs:
              type: array
              items:
                $ref: "#/components/schemas/Job"
    JobStage:
      type: object
      properties:
        id:
          type: integer
        jobId:
          type: integer
          description: Id of the job
        stageId:
          type: integer
        timestamp:
          $ref: "#/components/schemas/Timestamp"
        comments:
          type: string
          example: Comments about stage transition
        url:
          type: string
          example: https://mail.google.com/mail/u/0/#inbox/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
        _embedded:
          type: object
          properties:
            stage:
              $ref: "#/components/schemas/Stage"
    JobStageArray:
      type: array
      items:
        $ref: "#/components/schemas/JobStage"
    Post:
      type: object
    Timestamp:
      type: string
      format: date-time
      example: 2024-01-01T00:00:00Z
    Error:
      type: object
      properties:
        status:
          type: integer
          description: HTTP Response Status Code
          example: 500
        name:
          type: string
          description: A short, human-readable summary of the problem type.  It SHOULD NOT change from occurrence to occurrence of the problem, except for purposes of localization (e.g., using proactive content negotiation; see [RFC7231], Section 3.4)
          example: Error
        message:
          type: string
          description: A human readable message related to the current error which may be displayed to the user of the api.
          example: I'm sorry Dave. I'm afraid I can't do that.
    Collection:
      type: object
      description: A paginated collection of items
      properties:
        page:
          type: integer
          description: The current page
          example: 1
        pageSize:
          type: integer
          description: The maximum number of items per page
          example: 5
        pages:
          type: integer
          description: The total number of pages
          example: 5
        count:
          type: integer
          description: The number of items returned
          example: 5
        total:
          type: integer
          description: The total number of items
          example: 25
